<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<script type="text/javascript">
		var reg = /([0-9\.]+)|([ \t]+)|([\r\n]+)|(\+)|(\-)|(\*)|(\/)/g;
		var dictionary = ["Number", "Whitespace", "LineTerminator", "+", "-", "*", "/"];
		function* tokenize(val) {
			var result;
			var lastIndex = 0;
			while(true) {
				lastIndex = reg.lastIndex;
				result = reg.exec(val);
				
				if(!result) {
					break;
				}
				if(reg.lastIndex - lastIndex > result[0].length) {
					break;
				}
				for(let i = 1; i <= dictionary.length; i++) {
					if(result[i]) {
						let token = {
							type: dictionary[i - 1],
							value: result[i]
						}
						yield token;
					}
				}
			}
			yield {
				type: "EOF"
			}
		}
		let source = [];
		for(let token of tokenize("10 + 3 - 66")) {
			// console.log(token);
			if(token.type !== 'Whitespace' && token.type !== 'LineTerminator') {
				source.push(token);
			}
		}
		function Expression(tokens) {
			if(source[0].type === 'AdditiveExpression' && source[1] && source[1].type === 'EOF') {
				let node = {
					type: 'Expression',
					children: [source.shift(), source.shift()]
				}
				source.unshift(node);
				return Expression(source);
			}
		}
		function AdditiveExpression(source) {
			if(source[0].type === 'MultiplicativeExpression') {
				let node = {
					type: "AdditiveExpression",
					children: [source[0]]
				}
				source[0] = node;
				return AdditiveExpression(source);
			}
			if(source[0].type === 'AdditiveExpression' && source[1] && source[1].type === '+') {
				let node = {
					type: "AdditiveExpression",
					operator: '+',
					children: []
				}
				node.children.push(source.shift());
				node.children.push(source.shift());
				MultiplicativeExpression(source)
				node.children.push(source.shift());
				source.unshift(node);
				return AdditiveExpression(source);
			}
			if(source[0].type === 'MultiplicativeExpression' && source[1] && source[1].type === '-') {
				let node = {
					type: "MultiplicativeExpression",
					operator: '-',
					children: []
				}
				node.children.push(source.shift());
				node.children.push(source.shift());
				MultiplicativeExpression(source)
				node.children.push(source.shift());
				source.unshift(node);
				return AdditiveExpression(source);
			}
			if(source[0].type === 'AdditiveExpression') {
				return source[0];
			}
			MultiplicativeExpression(source);
			return AdditiveExpression(source);

		}
		function MultiplicativeExpression(source) {
			if(source[0].type === 'Number') {
				let node = {
					type: "MultiplicativeExpression",
					children: [source[0]]
				}
				source[0] = node;
				return MultiplicativeExpression(source);
			}
			if(source[0].type === 'MultiplicativeExpression' && source[1] && source[1].type === '*') {
				let node = {
					type: "MultiplicativeExpression",
					operator: '*',
					children: []
				}
				node.children.push(source.shift());
				node.children.push(source.shift());
				node.children.push(source.shift());
				source.unshift(node);
				return MultiplicativeExpression(source);
			}
			if(source[0].type === 'MultiplicativeExpression' && source[1] && source[1].type === '/') {
				let node = {
					type: "MultiplicativeExpression",
					operator: '/',
					children: []
				}
				node.children.push(source.shift());
				node.children.push(source.shift());
				node.children.push(source.shift());
				source.unshift(node);
				return MultiplicativeExpression(source);
			}
			if(source[0].type === 'MultiplicativeExpression') {
				return source[0];
			}
			return MultiplicativeExpression(source);
			// console.log(source)
		}
		console.log(AdditiveExpression(source));
		// tokenize("10 * 2 + 55")
	</script>
</body>
</html>